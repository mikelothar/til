# Git

## Checkout files with LF endings

GIT on Windows like to checkout every file with CRLF endings. We need LF endings, so there are two things you need to do (the following can also be done locally to your project, just ignore the `--global` part):

```bash
git config --global core.eol lf
git config --global core.autocrlf false
```

Your .gitconfig file should now contain this (as well as other relevant information):

```bash
[core]
    autocrlf = false
    eol = lf
```

## Commits today

This little command will show you what commits you did today. Good for when you need to register time on what you did at the end of the day.

```bash
git log --committer="your name" --since="5 days ago" --no-merges --pretty=format:"%<(20) %ar %s"
```

Output:
```bash
 33 minutes ago       IU-6260: make sure og:image always have https in prod
 2 hours ago          IU-6260: remove duplicate http/https
 3 days ago           IU-7998: fix hit area
 3 days ago           IU-7998: extend clickable area to whole div, give link pointer on hover
 3 days ago           IU-9679: don't show latest login time for 30 s if user closed the notification
 3 days ago           IU-9679: remove magic numbers
```

## Ignore local changes to a tracked file

```bash
git update-index --assume-unchanged <file>
```

To reverse it (should you want to track changes to all files again), use:

```bash
git update-index  --really-refresh --no-assume-unchanged
```

## Prefix Git message with Jira ID on commit
Assuming your branch were generated by Jira, it will be named something like `feature/IU-9547-foo`. 

If you then prefer all your commit messages to include this ID, like `IU-9547: init bar on foo`, but sometimes forget, or often get annoyed with adding this yourself, then this is for you. Here are two ways to do this (caution: I've experienced some issues on the latter when using VSC and changing branch).

### Using Git hooks
Go into your `.git/hooks` folder and create a file called `prepare-commit-msg` containing this:

```bash
#!/bin/bash
BRANCH_NAME=$(git symbolic-ref --short HEAD)
BRANCH_NAME="${BRANCH_NAME##*/}"
BRANCH_IN_COMMIT=$(grep -c "\[$BRANCH_NAME\]" $1)
if [ -n "$BRANCH_NAME" ] && \
    ! [[ $BRANCH_IN_COMMIT -ge 1 ]] && \
    [[ "$BRANCH_NAME" =~ (.*)?IU-[0-9]{1,10}(.*)? ]]
then
    JIRA_ID=$(echo $BRANCH_NAME | awk -F'IU-' '{print $NF}' | awk -F'-' '{print "IU-"$NR}')
    sed -i.bak -e "1s/^/$JIRA_ID: /" $1
fi
```

Make the file executable with `chmod +x prepare-commit-msg`. 

Next time you commit something, the prefix will be the branch name stripped from everything except the Jira ID, 
for example: `IU-9547:`.

### Using .gitmessage
Another way is to use a `.gitmessage` file (create this file in your home directory). Add this to your `.gitconfig` to let GIT know you want to use it:
```bash
[commit]
	template = ~/.gitmessage
```
Then, like before, in your `.git/hooks` folder, use the `post-checkout` file, add this:
```bash
#!/bin/bash                                                                      

BRANCH_NAME=$(git symbolic-ref --short HEAD)
BRANCH_NAME="${BRANCH_NAME##*/}"

if [ -n "$BRANCH_NAME" ] && \
	! [[ $BRANCH_IN_COMMIT -ge 1 ]] && \
	[[ "$BRANCH_NAME" =~ (.*)?IU-[0-9]{1,10}(.*)? ]]
then 
	JIRA_ID=$(echo $BRANCH_NAME | awk -F'IU-' '{print $NF}' | awk -F'-' '{print "IU-"$NR}')
	echo $JIRA_ID:  > ~/.gitmessage
fi

```
Whenever you check out a new branch, your `.gitmessage` file will be updated with the Jira ID.

## Show a list of branches on origin

```bash
git fetch origin
git branch -v -a
```

Oneliner: `git fetch origin ; git branch -v -a`

## Staging files
Different ways to stage changed files, and why `git add -A` could be preferred in some cases:

```bash
# stages new and modified, without deleted
git add .
```

```bash
# stages modified and deleted, without new
git add -u
```

```bash
# stages all
git add -A
```

To unstage files:

```bash
# removes added
git reset
```

